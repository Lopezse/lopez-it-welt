#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# üö¶ Freigabe-Check vor allen anderen Pr√ºfungen
node scripts/freigabe-check.js
if [ $? -ne 0 ]; then
  echo "üö® Commit abgebrochen: Es fehlt eine Freigabe!"
  exit 1
fi

# üõ°Ô∏è Anti-Regelbruch-System vor Commit pr√ºfen
echo "üõ°Ô∏è Anti-Regelbruch-System: Pre-Commit Validierung..."
node scripts/anti-rule-break-hook.js pre-commit

# Standard Tests (optional - nur wenn Scripts vorhanden)
if npm run test 2>/dev/null; then
  npm test || echo "‚ö†Ô∏è Tests fehlgeschlagen, aber Commit fortgesetzt."
fi

# Pre-Commit Freigabe-Check (falls vorhanden)
if [ -f scripts/pre-commit-freigabe-check.js ]; then
  node scripts/pre-commit-freigabe-check.js || exit 1
fi

# Lint (optional)
npm run lint || echo "‚ö†Ô∏è Lint-Warnungen, aber Commit fortgesetzt."

# --- Enterprise++ Pre-Commit: format + lint-staged ---
npx lint-staged || exit 1
