{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 127, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/app/api/admin/contact-messages/stats/route.ts"],"sourcesContent":["import mysql from \"mysql2/promise\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\n// GET /api/admin/contact-messages/stats - Statistiken für Badge-Updates\nexport async function GET(request: NextRequest) {\n  let connection: any = null;\n  try {\n    try {\n      connection = await mysql.createConnection({\n        host: \"localhost\",\n        user: \"root\",\n        password: \"\",\n        database: \"lopez_erp\",\n      });\n    } catch (dbError) {\n      console.error(\"❌ DB-Verbindungsfehler (contact-messages/stats):\", dbError);\n      // Fallback: Leere Statistiken zurückgeben statt HTTP 500\n      return NextResponse.json({\n        success: true,\n        stats: {\n          new_messages: 0,\n          in_progress: 0,\n          last_24h: 0,\n          urgent: 0,\n          total_active: 0,\n        },\n      });\n    }\n\n    try {\n      // Neue Nachrichten (Status: neu)\n      const newMessagesQuery = `\n            SELECT COUNT(*) as count\n            FROM lopez_business_contact_messages \n            WHERE status = 'neu' AND is_spam = 0\n        `;\n      const [newResult] = await connection.execute(newMessagesQuery);\n      const newMessages = (newResult as any)[0]?.count || 0;\n\n      // Nachrichten in Bearbeitung\n      const inProgressQuery = `\n            SELECT COUNT(*) as count\n            FROM lopez_business_contact_messages \n            WHERE status = 'in_bearbeitung' AND is_spam = 0\n        `;\n      const [progressResult] = await connection.execute(inProgressQuery);\n      const inProgress = (progressResult as any)[0]?.count || 0;\n\n      // Nachrichten der letzten 24 Stunden\n      const last24hQuery = `\n            SELECT COUNT(*) as count\n            FROM lopez_business_contact_messages \n            WHERE created_at >= DATE_SUB(NOW(), INTERVAL 24 HOUR) AND is_spam = 0\n        `;\n      const [last24hResult] = await connection.execute(last24hQuery);\n      const last24h = (last24hResult as any)[0]?.count || 0;\n\n      // Dringende Nachrichten (Priority: hoch oder dringend)\n      const urgentQuery = `\n            SELECT COUNT(*) as count\n            FROM lopez_business_contact_messages \n            WHERE priority IN ('hoch', 'dringend') AND status != 'erledigt' AND is_spam = 0\n        `;\n      const [urgentResult] = await connection.execute(urgentQuery);\n      const urgent = (urgentResult as any)[0]?.count || 0;\n\n      if (connection) {\n        try {\n          await connection.end();\n        } catch {}\n      }\n\n      return NextResponse.json({\n        success: true,\n        stats: {\n          new_messages: newMessages,\n          in_progress: inProgress,\n          last_24h: last24h,\n          urgent: urgent,\n          total_active: newMessages + inProgress,\n        },\n      });\n    } catch (queryError) {\n      console.error(\"❌ SQL-Query-Fehler (contact-messages/stats):\", queryError);\n      if (connection) {\n        try {\n          await connection.end();\n        } catch {}\n      }\n      // Fallback: Leere Statistiken zurückgeben statt HTTP 500\n      return NextResponse.json({\n        success: true,\n        stats: {\n          new_messages: 0,\n          in_progress: 0,\n          last_24h: 0,\n          urgent: 0,\n          total_active: 0,\n        },\n      });\n    }\n  } catch (error) {\n    console.error(\"❌ Fehler beim Laden der Kontakt-Statistiken:\", error);\n    if (connection) {\n      try {\n        await connection.end();\n      } catch {}\n    }\n    // Fallback: Leere Statistiken zurückgeben statt HTTP 500\n    return NextResponse.json({\n      success: true,\n      stats: {\n        new_messages: 0,\n        in_progress: 0,\n        last_24h: 0,\n        urgent: 0,\n        total_active: 0,\n      },\n    });\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI,aAAkB;IACtB,IAAI;QACF,IAAI;YACF,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;gBACxC,MAAM;gBACN,MAAM;gBACN,UAAU;gBACV,UAAU;YACZ;QACF,EAAE,OAAO,SAAS;YAChB,QAAQ,KAAK,CAAC,oDAAoD;YAClE,yDAAyD;YACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;oBACL,cAAc;oBACd,aAAa;oBACb,UAAU;oBACV,QAAQ;oBACR,cAAc;gBAChB;YACF;QACF;QAEA,IAAI;YACF,iCAAiC;YACjC,MAAM,mBAAmB,CAAC;;;;QAIxB,CAAC;YACH,MAAM,CAAC,UAAU,GAAG,MAAM,WAAW,OAAO,CAAC;YAC7C,MAAM,cAAc,AAAC,SAAiB,CAAC,EAAE,EAAE,SAAS;YAEpD,6BAA6B;YAC7B,MAAM,kBAAkB,CAAC;;;;QAIvB,CAAC;YACH,MAAM,CAAC,eAAe,GAAG,MAAM,WAAW,OAAO,CAAC;YAClD,MAAM,aAAa,AAAC,cAAsB,CAAC,EAAE,EAAE,SAAS;YAExD,qCAAqC;YACrC,MAAM,eAAe,CAAC;;;;QAIpB,CAAC;YACH,MAAM,CAAC,cAAc,GAAG,MAAM,WAAW,OAAO,CAAC;YACjD,MAAM,UAAU,AAAC,aAAqB,CAAC,EAAE,EAAE,SAAS;YAEpD,uDAAuD;YACvD,MAAM,cAAc,CAAC;;;;QAInB,CAAC;YACH,MAAM,CAAC,aAAa,GAAG,MAAM,WAAW,OAAO,CAAC;YAChD,MAAM,SAAS,AAAC,YAAoB,CAAC,EAAE,EAAE,SAAS;YAElD,IAAI,YAAY;gBACd,IAAI;oBACF,MAAM,WAAW,GAAG;gBACtB,EAAE,OAAM,CAAC;YACX;YAEA,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;oBACL,cAAc;oBACd,aAAa;oBACb,UAAU;oBACV,QAAQ;oBACR,cAAc,cAAc;gBAC9B;YACF;QACF,EAAE,OAAO,YAAY;YACnB,QAAQ,KAAK,CAAC,gDAAgD;YAC9D,IAAI,YAAY;gBACd,IAAI;oBACF,MAAM,WAAW,GAAG;gBACtB,EAAE,OAAM,CAAC;YACX;YACA,yDAAyD;YACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;gBACvB,SAAS;gBACT,OAAO;oBACL,cAAc;oBACd,aAAa;oBACb,UAAU;oBACV,QAAQ;oBACR,cAAc;gBAChB;YACF;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,gDAAgD;QAC9D,IAAI,YAAY;YACd,IAAI;gBACF,MAAM,WAAW,GAAG;YACtB,EAAE,OAAM,CAAC;QACX;QACA,yDAAyD;QACzD,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT,OAAO;gBACL,cAAc;gBACd,aAAa;gBACb,UAAU;gBACV,QAAQ;gBACR,cAAc;YAChB;QACF;IACF;AACF","debugId":null}}]
}