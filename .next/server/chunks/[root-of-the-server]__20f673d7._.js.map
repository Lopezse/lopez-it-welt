{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/app/api/admin/time-tracking/stats/route.ts"],"sourcesContent":["import { promises as fs } from \"fs\";\nimport { NextResponse } from \"next/server\";\nimport path from \"path\";\n\ninterface TimeSession {\n  id: number;\n  user_id: number;\n  module: string;\n  start_time: string;\n  end_time?: string;\n  duration_minutes?: number;\n  taetigkeit: string;\n  status: \"active\" | \"completed\" | \"interrupted\";\n  problem?: string;\n  ausloeser?: string;\n  category: string;\n  priority: string;\n  created_at: string;\n  updated_at: string;\n}\n\n// Datei-Pfad für Sessions\nconst SESSIONS_FILE = path.join(process.cwd(), \"data\", \"time-sessions.json\");\n\n// Sessions laden\nasync function loadSessions(): Promise<TimeSession[]> {\n  try {\n    const data = await fs.readFile(SESSIONS_FILE, \"utf-8\");\n    return JSON.parse(data);\n  } catch (error) {\n    return [];\n  }\n}\n\n// Hilfsfunktion um Dauer zwischen zwei Zeiten zu berechnen\nfunction calculateDuration(startTime: string, endTime: string): number {\n  const start = new Date(startTime);\n  const end = new Date(endTime);\n  return Math.round((end.getTime() - start.getTime()) / (1000 * 60)); // Minuten\n}\n\n// Prüfen ob ein Datum heute ist\nfunction isToday(dateString: string): boolean {\n  const today = new Date().toDateString();\n  const date = new Date(dateString).toDateString();\n  return today === date;\n}\n\nexport async function GET() {\n  try {\n    const sessions = await loadSessions();\n    const now = new Date().toISOString();\n    const today = new Date(now).toDateString();\n\n    // Berechne Statistiken\n    const totalSessions = sessions.length;\n    const activeSessions = sessions.filter((s) => s.status === \"active\").length;\n\n    let totalTime = 0;\n    let todayTime = 0;\n    const statusStats = { active: 0, completed: 0, interrupted: 0 };\n    const categoryStats: Record<string, number> = {};\n    const problemStats: Record<string, number> = {};\n    const moduleStats: Record<string, number> = {};\n    const ausloeserStats: Record<string, number> = {};\n\n    sessions.forEach((session) => {\n      // Status-Statistiken\n      statusStats[session.status]++;\n\n      // Kategorie-Statistiken\n      categoryStats[session.category] = (categoryStats[session.category] || 0) + 1;\n\n      // Modul-Statistiken\n      moduleStats[session.module] = (moduleStats[session.module] || 0) + 1;\n\n      // Auslöser-Statistiken\n      if (session.ausloeser) {\n        ausloeserStats[session.ausloeser] = (ausloeserStats[session.ausloeser] || 0) + 1;\n      }\n\n      // Problem-Statistiken\n      if (session.problem) {\n        problemStats[session.problem] = (problemStats[session.problem] || 0) + 1;\n      }\n\n      // Zeit-Berechnungen\n      if (session.end_time) {\n        const duration = calculateDuration(session.start_time, session.end_time);\n        totalTime += duration;\n\n        // Heute gearbeitete Zeit\n        if (isToday(session.start_time)) {\n          todayTime += duration;\n        }\n      }\n    });\n\n    // Durchschnittliche Dauer\n    const completedSessions = sessions.filter(\n      (s) => s.status === \"completed\" && s.duration_minutes,\n    );\n    const avgDuration =\n      completedSessions.length > 0\n        ? Math.round(\n            completedSessions.reduce((sum, s) => sum + (s.duration_minutes || 0), 0) /\n              completedSessions.length,\n          )\n        : 0;\n\n    // Erfolgsrate\n    const successRate =\n      totalSessions > 0 ? Math.round((statusStats.completed / totalSessions) * 100) : 0;\n\n    const stats = {\n      totalSessions,\n      activeSessions,\n      totalTime,\n      todayTime,\n      statusStats,\n      categoryStats,\n      problemStats,\n      moduleStats,\n      ausloeserStats,\n      avgDuration,\n      successRate,\n    };\n\n    return NextResponse.json(stats);\n  } catch (error) {\n    // Fehler beim Abrufen der Statistiken: ${error}\n    return NextResponse.json({ error: \"Fehler beim Abrufen der Statistiken\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}