{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/app/api/admin/ki-sessions/route.ts"],"sourcesContent":["import { KISession } from \"@/lib/ki-action-tracker\";\nimport { promises as fs } from \"fs\";\nimport { NextRequest, NextResponse } from \"next/server\";\nimport path from \"path\";\n\n// Datei-Pfad für KI-Sessions\nconst KI_SESSIONS_FILE = path.join(process.cwd(), \"data\", \"ki-sessions.json\");\n\n// KI-Sessions laden\nasync function loadKISessions(): Promise<KISession[]> {\n  try {\n    const data = await fs.readFile(KI_SESSIONS_FILE, \"utf-8\");\n    return JSON.parse(data);\n  } catch (error) {\n    // Datei existiert nicht oder ist leer\n    return [];\n  }\n}\n\n// KI-Sessions speichern\nasync function saveKISessions(sessions: KISession[]): Promise<void> {\n  try {\n    // Verzeichnis erstellen falls nicht vorhanden\n    const dir = path.dirname(KI_SESSIONS_FILE);\n    await fs.mkdir(dir, { recursive: true });\n\n    await fs.writeFile(KI_SESSIONS_FILE, JSON.stringify(sessions, null, 2));\n  } catch (error) {\n    // Fehler beim Speichern der KI-Sessions: ${error}\n  }\n}\n\nexport async function GET() {\n  try {\n    const sessions = await loadKISessions();\n    return NextResponse.json(sessions);\n  } catch (error) {\n    // Fehler beim Abrufen der KI-Sessions: ${error}\n    return NextResponse.json({ error: \"Fehler beim Abrufen der KI-Sessions\" }, { status: 500 });\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    // Prüfen ob Request-Body leer ist\n    const contentType = request.headers.get(\"content-type\");\n    if (!contentType || !contentType.includes(\"application/json\")) {\n      return NextResponse.json(\n        { error: \"Content-Type muss application/json sein\" },\n        { status: 400 },\n      );\n    }\n\n    const body = await request.json();\n\n    // Prüfen ob Body leer ist\n    if (!body || Object.keys(body).length === 0) {\n      return NextResponse.json({ error: \"Request-Body darf nicht leer sein\" }, { status: 400 });\n    }\n\n    const session: KISession = body;\n\n    if (!session.session_id || !session.modul || !session.triggered_by) {\n      return NextResponse.json(\n        { error: \"session_id, modul und triggered_by sind Pflichtfelder\" },\n        { status: 400 },\n      );\n    }\n\n    const sessions = await loadKISessions();\n\n    // Prüfen ob Session bereits existiert\n    const existingSessionIndex = sessions.findIndex((s) => s.session_id === session.session_id);\n\n    if (existingSessionIndex !== -1) {\n      // Session aktualisieren\n      sessions[existingSessionIndex] = {\n        ...sessions[existingSessionIndex],\n        ...session,\n        updated_at: new Date().toISOString(),\n      };\n    } else {\n      // Neue Session hinzufügen\n      sessions.push({\n        ...session,\n        created_at: session.created_at || new Date().toISOString(),\n        updated_at: new Date().toISOString(),\n      });\n    }\n\n    await saveKISessions(sessions);\n\n    // KI-Session gespeichert: ${session.session_id} - ${session.modul}\n    return NextResponse.json(session, { status: 201 });\n  } catch (error) {\n    // Fehler beim Speichern der KI-Session: ${error}\n    return NextResponse.json({ error: \"Fehler beim Speichern der KI-Session\" }, { status: 500 });\n  }\n}\n\nexport async function PUT(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const { session_id, ...updateData } = body;\n\n    const sessions = await loadKISessions();\n    const sessionIndex = sessions.findIndex((s) => s.session_id === session_id);\n\n    if (sessionIndex === -1) {\n      return NextResponse.json({ error: \"KI-Session nicht gefunden\" }, { status: 404 });\n    }\n\n    const updatedSession = {\n      ...sessions[sessionIndex],\n      ...updateData,\n      updated_at: new Date().toISOString(),\n    };\n\n    sessions[sessionIndex] = updatedSession;\n    await saveKISessions(sessions);\n\n    return NextResponse.json(updatedSession);\n  } catch (error) {\n    // Fehler beim Aktualisieren der KI-Session: ${error}\n    return NextResponse.json(\n      { error: \"Fehler beim Aktualisieren der KI-Session\" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}