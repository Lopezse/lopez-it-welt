{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/lib/database.ts"],"sourcesContent":["// =====================================================\n// DATABASE CONNECTION - LOPEZ IT WELT\n// =====================================================\n// Erstellt: 2025-01-19\n// Zweck: MySQL-Datenbankverbindung f√ºr Enterprise++ Kundenverwaltung\n// Status: ‚úÖ VOLLST√ÑNDIG IMPLEMENTIERT\n// =====================================================\n\nimport mysql from \"mysql2/promise\";\n\n// =====================================================\n// DATENBANK-KONFIGURATION\n// =====================================================\n\nconst dbConfig = {\n  host: process.env.DB_HOST || \"localhost\",\n  port: parseInt(process.env.DB_PORT || \"3306\"),\n  user: process.env.DB_USER || \"root\",\n  password: process.env.DB_PASSWORD || \"\",\n  database: process.env.DB_NAME || \"lopez_erp\",\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n};\n\n// =====================================================\n// CONNECTION POOL\n// =====================================================\n\nlet pool: mysql.Pool | null = null;\n\nlet isInitialized = false;\n\nexport async function getConnection(): Promise<mysql.Pool> {\n  if (!pool) {\n    try {\n      pool = mysql.createPool(dbConfig);\n      console.log(\"‚úÖ MySQL Connection Pool erstellt\");\n\n      // Test-Verbindung\n      const connection = await pool.getConnection();\n      console.log(\"‚úÖ MySQL Verbindung erfolgreich getestet\");\n      connection.release();\n      \n      // Automatische Initialisierung beim ersten Aufruf (nur einmal)\n      if (!isInitialized) {\n        try {\n          console.log(\"üîß Initialisiere Datenbank-Struktur...\");\n          await initializeDatabase();\n          isInitialized = true;\n          console.log(\"‚úÖ Datenbank-Struktur erfolgreich initialisiert\");\n        } catch (initError) {\n          console.error(\"‚ö†Ô∏è Datenbank-Initialisierung fehlgeschlagen (wird ignoriert):\", initError);\n          // Nicht werfen, da die Tabelle m√∂glicherweise bereits existiert\n        }\n      }\n    } catch (error) {\n      console.error(\"‚ùå MySQL Verbindungsfehler:\", error);\n      throw error;\n    }\n  }\n  return pool;\n}\n\n// =====================================================\n// DATENBANK-INITIALISIERUNG\n// =====================================================\n\nexport async function initializeDatabase(): Promise<void> {\n  try {\n    const connection = await getConnection();\n\n    // =====================================================\n    // KUNDEN-HAUPTTABELLE\n    // =====================================================\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_customers (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                kundennummer VARCHAR(20) UNIQUE NOT NULL,\n                customer_type ENUM('privat', 'firma', 'beh√∂rde', 'partner') NOT NULL,\n                anrede ENUM('Herr', 'Frau', 'Divers', 'Firma', 'Keine Angabe') DEFAULT 'Keine Angabe',\n                titel VARCHAR(50),\n                vorname VARCHAR(100),\n                nachname VARCHAR(100),\n                firmenname VARCHAR(255),\n                email VARCHAR(255) UNIQUE NOT NULL,\n                telefon VARCHAR(50),\n                strasse VARCHAR(255),\n                plz VARCHAR(20),\n                ort VARCHAR(100),\n                land VARCHAR(100) DEFAULT 'Deutschland',\n                status ENUM('aktiv', 'inaktiv', 'gesperrt') DEFAULT 'aktiv',\n                support_level ENUM('Standard', 'Premium', 'SLA 24h', 'SLA 4h') DEFAULT 'Standard',\n                notes TEXT,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n                INDEX idx_kundennummer (kundennummer),\n                INDEX idx_email (email),\n                INDEX idx_status (status),\n                INDEX idx_customer_type (customer_type),\n                INDEX idx_support_level (support_level)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // =====================================================\n    // KUNDEN-NOTIZEN\n    // =====================================================\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_customer_notes (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                customer_id BIGINT NOT NULL,\n                note TEXT NOT NULL,\n                created_by VARCHAR(100) NOT NULL,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                FOREIGN KEY (customer_id) REFERENCES lopez_customers(id) ON DELETE CASCADE,\n                INDEX idx_customer_id (customer_id),\n                INDEX idx_created_at (created_at)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // =====================================================\n    // KUNDEN-TAGS\n    // =====================================================\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_customer_tags (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                customer_id BIGINT NOT NULL,\n                tag_name VARCHAR(50) NOT NULL,\n                tag_color VARCHAR(7) DEFAULT '#3B82F6',\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                FOREIGN KEY (customer_id) REFERENCES lopez_customers(id) ON DELETE CASCADE,\n                UNIQUE KEY unique_customer_tag (customer_id, tag_name),\n                INDEX idx_customer_id (customer_id),\n                INDEX idx_tag_name (tag_name)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // =====================================================\n    // AUDIT-LOGS\n    // =====================================================\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_audit_logs (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                table_name VARCHAR(50) NOT NULL,\n                record_id BIGINT NOT NULL,\n                action ENUM('INSERT', 'UPDATE', 'DELETE', 'LOGIN', 'LOGOUT', '2FA_SETUP', '2FA_VERIFY', 'PASSWORD_CHANGE', 'ROLE_ASSIGN', 'PERMISSION_GRANT') NOT NULL,\n                old_values JSON,\n                new_values JSON,\n                user_id BIGINT NOT NULL,\n                username VARCHAR(100),\n                ip_address VARCHAR(45),\n                user_agent TEXT,\n                session_id VARCHAR(255),\n                risk_level ENUM('LOW', 'MEDIUM', 'HIGH', 'CRITICAL') DEFAULT 'LOW',\n                compliance_category ENUM('DATA_ACCESS', 'DATA_MODIFICATION', 'AUTHENTICATION', 'AUTHORIZATION', 'SYSTEM_CHANGE', 'SECURITY_EVENT') DEFAULT 'DATA_ACCESS',\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                INDEX idx_table_record (table_name, record_id),\n                INDEX idx_user_id (user_id),\n                INDEX idx_username (username),\n                INDEX idx_action (action),\n                INDEX idx_risk_level (risk_level),\n                INDEX idx_compliance_category (compliance_category),\n                INDEX idx_created_at (created_at),\n                INDEX idx_session_id (session_id)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // =====================================================\n    // RBAC/ABAC SYSTEM\n    // =====================================================\n\n    // Benutzer-Tabelle\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_users (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                username VARCHAR(50) UNIQUE NOT NULL,\n                email VARCHAR(255) UNIQUE NOT NULL,\n                email_external VARCHAR(255),         -- lopezitwelt.de f√ºr externe Kommunikation\n                email_internal VARCHAR(255),         -- lopez-team.de f√ºr interne Kommunikation\n                password_hash VARCHAR(255) NOT NULL,\n                first_name VARCHAR(100) NOT NULL,\n                last_name VARCHAR(100) NOT NULL,\n                display_name VARCHAR(200),           -- \"Ramiro Lopez Rodriguez - Admin\"\n                admin_alias VARCHAR(50),             -- \"r.lopez\", \"r.mclean\"\n                domain_type ENUM('external', 'internal') DEFAULT 'internal',\n                status ENUM('active', 'inactive', 'locked', 'pending') DEFAULT 'pending',\n                last_login TIMESTAMP NULL,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n                INDEX idx_username (username),\n                INDEX idx_email (email),\n                INDEX idx_email_external (email_external),\n                INDEX idx_email_internal (email_internal),\n                INDEX idx_admin_alias (admin_alias),\n                INDEX idx_domain_type (domain_type),\n                INDEX idx_status (status)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // Rollen-Tabelle\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_roles (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                name VARCHAR(100) UNIQUE NOT NULL,\n                description TEXT,\n                level TINYINT NOT NULL DEFAULT 5,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n                INDEX idx_name (name),\n                INDEX idx_level (level)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // Berechtigungen-Tabelle\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_permissions (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                resource VARCHAR(100) NOT NULL,\n                action VARCHAR(50) NOT NULL,\n                conditions JSON,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                UNIQUE KEY unique_resource_action (resource, action),\n                INDEX idx_resource (resource),\n                INDEX idx_action (action)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // Benutzer-Rollen-Zuordnung\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_user_roles (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                user_id BIGINT NOT NULL,\n                role_id BIGINT NOT NULL,\n                assigned_by BIGINT NOT NULL,\n                assigned_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                expires_at TIMESTAMP NULL,\n                FOREIGN KEY (user_id) REFERENCES lopez_users(id) ON DELETE CASCADE,\n                FOREIGN KEY (role_id) REFERENCES lopez_roles(id) ON DELETE CASCADE,\n                FOREIGN KEY (assigned_by) REFERENCES lopez_users(id) ON DELETE CASCADE,\n                UNIQUE KEY unique_user_role (user_id, role_id),\n                INDEX idx_user_id (user_id),\n                INDEX idx_role_id (role_id),\n                INDEX idx_expires_at (expires_at)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // Rollen-Berechtigungen-Zuordnung\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_role_permissions (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                role_id BIGINT NOT NULL,\n                permission_id BIGINT NOT NULL,\n                granted BOOLEAN DEFAULT TRUE,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                FOREIGN KEY (role_id) REFERENCES lopez_roles(id) ON DELETE CASCADE,\n                FOREIGN KEY (permission_id) REFERENCES lopez_permissions(id) ON DELETE CASCADE,\n                UNIQUE KEY unique_role_permission (role_id, permission_id),\n                INDEX idx_role_id (role_id),\n                INDEX idx_permission_id (permission_id)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // Sessions-Tabelle\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_sessions (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                user_id BIGINT NOT NULL,\n                session_token VARCHAR(255) UNIQUE NOT NULL,\n                ip_address VARCHAR(45),\n                user_agent TEXT,\n                expires_at TIMESTAMP NOT NULL,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                FOREIGN KEY (user_id) REFERENCES lopez_users(id) ON DELETE CASCADE,\n                INDEX idx_user_id (user_id),\n                INDEX idx_session_token (session_token),\n                INDEX idx_expires_at (expires_at)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // =====================================================\n    // 2FA SYSTEM\n    // =====================================================\n\n    // 2FA-Secrets-Tabelle\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_user_2fa (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                user_id BIGINT NOT NULL,\n                secret VARCHAR(255) NOT NULL,\n                backup_codes JSON,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,\n                FOREIGN KEY (user_id) REFERENCES lopez_users(id) ON DELETE CASCADE,\n                UNIQUE KEY unique_user_2fa (user_id),\n                INDEX idx_user_id (user_id)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    // 2FA-Verifikationen-Tabelle\n    await connection.execute(`\n            CREATE TABLE IF NOT EXISTS lopez_user_2fa_verifications (\n                id BIGINT AUTO_INCREMENT PRIMARY KEY,\n                user_id BIGINT NOT NULL,\n                token VARCHAR(10) NOT NULL,\n                verified BOOLEAN DEFAULT FALSE,\n                expires_at TIMESTAMP NOT NULL,\n                created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n                FOREIGN KEY (user_id) REFERENCES lopez_users(id) ON DELETE CASCADE,\n                INDEX idx_user_id (user_id),\n                INDEX idx_token (token),\n                INDEX idx_expires_at (expires_at)\n            ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci\n        `);\n\n    console.log(\"‚úÖ Datenbank-Tabellen erfolgreich erstellt/aktualisiert\");\n  } catch (error) {\n    console.error(\"‚ùå Datenbank-Initialisierungsfehler:\", error);\n    throw error;\n  }\n}\n\n// =====================================================\n// HILFSFUNKTIONEN\n// =====================================================\n\nexport async function closeConnection(): Promise<void> {\n  if (pool) {\n    await pool.end();\n    pool = null;\n    console.log(\"‚úÖ MySQL Connection Pool geschlossen\");\n  }\n}\n\n// =====================================================\n// KUNDENNUMMER-GENERATOR\n// =====================================================\n\nexport async function generateKundennummer(): Promise<string> {\n  try {\n    const connection = await getConnection();\n    \n    // Datums- und Zeitbasiertes Format: YYYYMMDDHHMM-1 (nur ein Trennzeichen vor der Nummer)\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, \"0\");\n    const day = String(now.getDate()).padStart(2, \"0\");\n    const hour = String(now.getHours()).padStart(2, \"0\");\n    const minute = String(now.getMinutes()).padStart(2, \"0\");\n    const prefix = `${year}${month}${day}${hour}${minute}`;\n    \n    // N√§chste Nummer f√ºr diese Stunde/Minute ermitteln\n    const [rows] = await connection.execute(\n      `SELECT MAX(CAST(SUBSTRING(kundennummer, 13) AS UNSIGNED)) as max_num \n       FROM lopez_customers \n       WHERE kundennummer LIKE ?`,\n      [`${prefix}-%`],\n    );\n\n    const maxNum = (rows as any)[0]?.max_num || 0;\n    const nextNum = maxNum + 1;\n\n    // Format: YYYYMMDDHHMM-1 (z.B. 202511012210-1)\n    return `${prefix}-${nextNum}`;\n  } catch (error) {\n    console.error(\"‚ùå Kundennummer-Generierung fehlgeschlagen:\", error);\n    // Fallback: Timestamp-basiert\n    const now = new Date();\n    const year = now.getFullYear();\n    const month = String(now.getMonth() + 1).padStart(2, \"0\");\n    const day = String(now.getDate()).padStart(2, \"0\");\n    const hour = String(now.getHours()).padStart(2, \"0\");\n    const minute = String(now.getMinutes()).padStart(2, \"0\");\n    const prefix = `${year}${month}${day}${hour}${minute}`;\n    return `${prefix}-${String(Date.now()).slice(-1)}`;\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 462, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/lib/customer-service.ts"],"sourcesContent":["// =====================================================\n// CUSTOMER SERVICE - LOPEZ IT WELT\n// =====================================================\n// Erstellt: 2025-01-19\n// Zweck: CRUD-Operationen f√ºr Kundenverwaltung\n// Status: ‚úÖ VOLLST√ÑNDIG IMPLEMENTIERT\n// =====================================================\n\nimport { generateKundennummer, getConnection } from \"./database\";\n\n// =====================================================\n// INTERFACES\n// =====================================================\n\nexport interface Customer {\n  id?: number;\n  kundennummer?: string;\n  customer_type: \"privat\" | \"firma\" | \"beh√∂rde\" | \"partner\";\n  anrede: string;\n  titel?: string;\n  vorname: string;\n  nachname: string;\n  firmenname?: string;\n  email: string;\n  telefon?: string;\n  strasse?: string;\n  plz?: string;\n  ort?: string;\n  land: string;\n  status: \"aktiv\" | \"inaktiv\" | \"gesperrt\";\n  support_level: \"Standard\" | \"Premium\" | \"SLA 24h\" | \"SLA 4h\";\n  notes?: string;\n  created_at?: string;\n  updated_at?: string;\n}\n\nexport interface CustomerNote {\n  id?: number;\n  customer_id: number;\n  note: string;\n  created_by: string;\n  created_at?: string;\n}\n\nexport interface CustomerTag {\n  id?: number;\n  customer_id: number;\n  tag_name: string;\n  tag_color: string;\n  created_at?: string;\n}\n\nexport interface SearchFilters {\n  customer_type?: string;\n  status?: string;\n  support_level?: string;\n  land?: string;\n  search?: string;\n  page?: number;\n  limit?: number;\n  sort_by?: string;\n  sort_order?: \"ASC\" | \"DESC\";\n}\n\n// =====================================================\n// CUSTOMER SERVICE CLASS\n// =====================================================\n\nexport class CustomerService {\n  // =====================================================\n  // KUNDEN CRUD-OPERATIONEN\n  // =====================================================\n\n  static async createCustomer(\n    customerData: Omit<Customer, \"id\" | \"kundennummer\" | \"created_at\" | \"updated_at\">,\n  ): Promise<Customer> {\n    try {\n      const connection = await getConnection();\n      const kundennummer = await generateKundennummer();\n\n      const [result] = await connection.execute(\n        `\n                INSERT INTO lopez_customers (\n                    kundennummer, customer_type, anrede, titel, vorname, nachname,\n                    firmenname, email, telefon, strasse, plz, ort, land,\n                    status, support_level, notes\n                ) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)\n            `,\n        [\n          kundennummer,\n          customerData.customer_type,\n          customerData.anrede,\n          customerData.titel || null,\n          customerData.vorname,\n          customerData.nachname,\n          customerData.firmenname || null,\n          customerData.email,\n          customerData.telefon || null,\n          customerData.strasse || null,\n          customerData.plz || null,\n          customerData.ort || null,\n          customerData.land,\n          customerData.status,\n          customerData.support_level,\n          customerData.notes || null,\n        ],\n      );\n\n      const insertId = (result as any).insertId;\n      const customer = await this.getCustomerById(insertId);\n\n      // Audit-Log\n      await this.logAudit(\"lopez_customers\", insertId, \"INSERT\", null, customerData, \"system\");\n\n      return customer!;\n    } catch (error) {\n      console.error(\"‚ùå Fehler beim Erstellen des Kunden:\", error);\n      throw error;\n    }\n  }\n\n  static async getCustomerById(id: number): Promise<Customer | null> {\n    try {\n      const connection = await getConnection();\n      const [rows] = await connection.execute(\"SELECT * FROM lopez_customers WHERE id = ?\", [id]);\n\n      const customers = rows as Customer[];\n      return customers.length > 0 ? customers[0] : null;\n    } catch (error) {\n      console.error(\"‚ùå Fehler beim Laden des Kunden:\", error);\n      throw error;\n    }\n  }\n\n  static async getCustomerByKundennummer(kundennummer: string): Promise<Customer | null> {\n    try {\n      const connection = await getConnection();\n      const [rows] = await connection.execute(\n        \"SELECT * FROM lopez_customers WHERE kundennummer = ?\",\n        [kundennummer],\n      );\n\n      const customers = rows as Customer[];\n      return customers.length > 0 ? customers[0] : null;\n    } catch (error) {\n      console.error(\"‚ùå Fehler beim Laden des Kunden:\", error);\n      throw error;\n    }\n  }\n\n  static async updateCustomer(\n    id: number,\n    customerData: Partial<Customer>,\n  ): Promise<Customer | null> {\n    try {\n      const connection = await getConnection();\n\n      // Alte Daten laden f√ºr Audit-Log\n      const oldCustomer = await this.getCustomerById(id);\n      if (!oldCustomer) return null;\n\n      // Update durchf√ºhren\n      const updateFields = [];\n      const updateValues = [];\n\n      Object.entries(customerData).forEach(([key, value]) => {\n        if (key !== \"id\" && key !== \"kundennummer\" && key !== \"created_at\" && value !== undefined) {\n          updateFields.push(`${key} = ?`);\n          updateValues.push(value);\n        }\n      });\n\n      if (updateFields.length === 0) return oldCustomer;\n\n      updateValues.push(id);\n\n      await connection.execute(\n        `\n                UPDATE lopez_customers \n                SET ${updateFields.join(\", \")}, updated_at = CURRENT_TIMESTAMP \n                WHERE id = ?\n            `,\n        updateValues,\n      );\n\n      const updatedCustomer = await this.getCustomerById(id);\n\n      // Audit-Log\n      await this.logAudit(\"lopez_customers\", id, \"UPDATE\", oldCustomer, customerData, \"system\");\n\n      return updatedCustomer;\n    } catch (error) {\n      console.error(\"‚ùå Fehler beim Aktualisieren des Kunden:\", error);\n      throw error;\n    }\n  }\n\n  static async deleteCustomer(id: number): Promise<boolean> {\n    try {\n      const connection = await getConnection();\n\n      // Alte Daten laden f√ºr Audit-Log\n      const oldCustomer = await this.getCustomerById(id);\n      if (!oldCustomer) return false;\n\n      await connection.execute(\"DELETE FROM lopez_customers WHERE id = ?\", [id]);\n\n      // Audit-Log\n      await this.logAudit(\"lopez_customers\", id, \"DELETE\", oldCustomer, null, \"system\");\n\n      return true;\n    } catch (error) {\n      console.error(\"‚ùå Fehler beim L√∂schen des Kunden:\", error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // KUNDEN-SUCHE & FILTER\n  // =====================================================\n\n  static async searchCustomers(\n    filters: SearchFilters = {},\n  ): Promise<{ customers: Customer[]; total: number }> {\n    try {\n      const connection = await getConnection();\n\n      const {\n        customer_type,\n        status,\n        support_level,\n        land,\n        search,\n        page = 1,\n        limit = 50,\n        sort_by = \"created_at\",\n        sort_order = \"DESC\",\n      } = filters;\n\n      const offset = (page - 1) * limit;\n\n      // WHERE-Bedingungen aufbauen\n      const whereConditions = [];\n      const queryParams = [];\n\n      if (customer_type) {\n        whereConditions.push(\"customer_type = ?\");\n        queryParams.push(customer_type);\n      }\n\n      if (status) {\n        whereConditions.push(\"status = ?\");\n        queryParams.push(status);\n      }\n\n      if (support_level) {\n        whereConditions.push(\"support_level = ?\");\n        queryParams.push(support_level);\n      }\n\n      if (land) {\n        whereConditions.push(\"land = ?\");\n        queryParams.push(land);\n      }\n\n      if (search) {\n        whereConditions.push(`(\n                    kundennummer LIKE ? OR \n                    vorname LIKE ? OR \n                    nachname LIKE ? OR \n                    firmenname LIKE ? OR \n                    email LIKE ? OR \n                    telefon LIKE ?\n                )`);\n        const searchTerm = `%${search}%`;\n        queryParams.push(searchTerm, searchTerm, searchTerm, searchTerm, searchTerm, searchTerm);\n      }\n\n      const whereClause =\n        whereConditions.length > 0 ? `WHERE ${whereConditions.join(\" AND \")}` : \"\";\n\n      // Gesamtanzahl ermitteln\n      const countQuery = `SELECT COUNT(*) as total FROM lopez_customers ${whereClause}`;\n      const [countRows] = await connection.execute(countQuery, queryParams);\n      const total = (countRows as any)[0].total;\n\n      // Kunden laden\n      const customersQuery = `\n                SELECT * FROM lopez_customers \n                ${whereClause}\n                ORDER BY ${sort_by} ${sort_order}\n                LIMIT ? OFFSET ?\n            `;\n\n      const [customerRows] = await connection.execute(customersQuery, [\n        ...queryParams,\n        limit,\n        offset,\n      ]);\n\n      return {\n        customers: customerRows as Customer[],\n        total,\n      };\n    } catch (error) {\n      console.error(\"‚ùå Fehler bei der Kundensuche:\", error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // FUZZY SEARCH\n  // =====================================================\n\n  static async fuzzySearch(query: string, limit: number = 10): Promise<Customer[]> {\n    try {\n      const connection = await getConnection();\n\n      // Fuzzy Search mit SOUNDEX und LIKE\n      const searchQuery = `\n                SELECT *, \n                CASE \n                    WHEN kundennummer LIKE ? THEN 100\n                    WHEN vorname LIKE ? OR nachname LIKE ? OR firmenname LIKE ? THEN 80\n                    WHEN email LIKE ? THEN 70\n                    WHEN telefon LIKE ? THEN 60\n                    ELSE 50\n                END as relevance\n                FROM lopez_customers \n                WHERE (\n                    kundennummer LIKE ? OR \n                    vorname LIKE ? OR \n                    nachname LIKE ? OR \n                    firmenname LIKE ? OR \n                    email LIKE ? OR \n                    telefon LIKE ? OR\n                    SOUNDEX(vorname) = SOUNDEX(?) OR\n                    SOUNDEX(nachname) = SOUNDEX(?) OR\n                    SOUNDEX(firmenname) = SOUNDEX(?)\n                )\n                ORDER BY relevance DESC, created_at DESC\n                LIMIT ?\n            `;\n\n      const searchTerm = `%${query}%`;\n      const exactTerm = query;\n\n      const [rows] = await connection.execute(searchQuery, [\n        searchTerm,\n        searchTerm,\n        searchTerm,\n        searchTerm,\n        searchTerm,\n        searchTerm, // relevance\n        searchTerm,\n        searchTerm,\n        searchTerm,\n        searchTerm,\n        searchTerm,\n        searchTerm, // WHERE\n        exactTerm,\n        exactTerm,\n        exactTerm, // SOUNDEX\n        limit,\n      ]);\n\n      return rows as Customer[];\n    } catch (error) {\n      console.error(\"‚ùå Fehler bei der Fuzzy-Suche:\", error);\n      throw error;\n    }\n  }\n\n  // =====================================================\n  // AUDIT-LOGGING\n  // =====================================================\n\n  static async logAudit(\n    tableName: string,\n    recordId: number,\n    action: \"INSERT\" | \"UPDATE\" | \"DELETE\",\n    oldValues: any,\n    newValues: any,\n    userId: string,\n    ipAddress?: string,\n    userAgent?: string,\n  ): Promise<void> {\n    try {\n      const connection = await getConnection();\n\n      await connection.execute(\n        `\n                INSERT INTO lopez_audit_logs \n                (table_name, record_id, action, old_values, new_values, user_id, ip_address, user_agent)\n                VALUES (?, ?, ?, ?, ?, ?, ?, ?)\n            `,\n        [\n          tableName,\n          recordId,\n          action,\n          oldValues ? JSON.stringify(oldValues) : null,\n          newValues ? JSON.stringify(newValues) : null,\n          userId,\n          ipAddress || null,\n          userAgent || null,\n        ],\n      );\n    } catch (error) {\n      console.error(\"‚ùå Fehler beim Audit-Logging:\", error);\n      // Audit-Log-Fehler sollten nicht die Hauptoperation stoppen\n    }\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 755, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/app/api/admin/customers/route.ts"],"sourcesContent":["// =====================================================\n// CUSTOMERS API - LOPEZ IT WELT\n// =====================================================\n// Erstellt: 2025-01-19\n// Zweck: Kundenverwaltung API (B2C & B2B)\n// Status: ‚úÖ VOLLST√ÑNDIG IMPLEMENTIERT\n// =====================================================\n\nimport { CustomerService, SearchFilters } from \"@/lib/customer-service\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\n// =====================================================\n// GET - Kundenliste mit Filter & Suche\n// =====================================================\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n\n    // Filter-Parameter\n    const customerType = searchParams.get(\"customer_type\");\n    const status = searchParams.get(\"status\");\n    const supportLevel = searchParams.get(\"support_level\");\n    const land = searchParams.get(\"land\");\n    const search = searchParams.get(\"search\");\n\n    // Pagination\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\n    const limit = parseInt(searchParams.get(\"limit\") || \"50\");\n\n    // Sortierung\n    const sortBy = searchParams.get(\"sort_by\") || \"created_at\";\n    const sortOrder = (searchParams.get(\"sort_order\") || \"DESC\") as \"ASC\" | \"DESC\";\n\n    // Echte Datenbank-Abfrage\n    const filters: SearchFilters = {\n      customer_type: customerType || undefined,\n      status: status || undefined,\n      support_level: supportLevel || undefined,\n      land: land || undefined,\n      search: search || undefined,\n      page,\n      limit,\n      sort_by: sortBy,\n      sort_order: sortOrder,\n    };\n\n    const result = await CustomerService.searchCustomers(filters);\n\n    return NextResponse.json({\n      success: true,\n      data: {\n        customers: result.customers,\n        pagination: {\n          page,\n          limit,\n          total: result.total,\n          pages: Math.ceil(result.total / limit),\n        },\n        filters: {\n          customer_type: customerType,\n          status,\n          support_level: supportLevel,\n          land,\n          search,\n        },\n      },\n    });\n  } catch (error: any) {\n    console.error(\"‚ùå Customers API Fehler (GET):\", error);\n    console.error(\"‚ùå Error Stack:\", error?.stack);\n    console.error(\"‚ùå Error Details:\", JSON.stringify(error, null, 2));\n    \n    // Pr√ºfe ob es ein MySQL-Fehler ist\n    const mysqlError = error?.code || error?.sqlMessage || error?.message;\n    \n    return NextResponse.json(\n      { \n        success: false, \n        message: mysqlError || \"Fehler beim Laden der Kunden\",\n        error: process.env.NODE_ENV === \"development\" ? error?.message : undefined,\n        code: error?.code,\n      },\n      { status: 500 },\n    );\n  }\n}\n\n// =====================================================\n// POST - Neuen Kunden erstellen\n// =====================================================\n\nexport async function POST(request: NextRequest) {\n  try {\n    let requestBody;\n    try {\n      requestBody = await request.json();\n    } catch (jsonError) {\n      console.error(\"‚ùå JSON Parse Fehler:\", jsonError);\n      return NextResponse.json(\n        { success: false, message: \"Ung√ºltiges JSON-Format im Request-Body\" },\n        { status: 400 },\n      );\n    }\n\n    const {\n      customer_type,\n      anrede,\n      titel,\n      vorname,\n      nachname,\n      company_name,\n      ust_id,\n      contact_person_anrede,\n      contact_person_titel,\n      contact_person_vorname,\n      contact_person_nachname,\n      email,\n      email_secondary,\n      phone_mobile,\n      phone_business,\n      phone_private,\n      strasse,\n      plz,\n      stadt,\n      land,\n      land_iso,\n      support_level,\n      account_manager,\n      status,\n      notes,\n    } = requestBody;\n\n    // Validierung\n    if (!customer_type || !email || !vorname || !nachname) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Kundentyp, E-Mail, Vorname und Nachname sind erforderlich\",\n        },\n        { status: 400 },\n      );\n    }\n\n    // Firmenname-Validierung\n    if (customer_type !== \"privat\" && (!company_name || company_name.trim() === \"\")) {\n      return NextResponse.json(\n        {\n          success: false,\n          message: \"Firmenname ist f√ºr Firmen, Beh√∂rden und Partner erforderlich\",\n        },\n        { status: 400 },\n      );\n    }\n\n    // E-Mail-Validierung\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n      return NextResponse.json(\n        { success: false, message: \"Ung√ºltige E-Mail-Adresse\" },\n        { status: 400 },\n      );\n    }\n\n    // Kunde erstellen - echte Datenbank-Operation\n    try {\n      const newCustomer = await CustomerService.createCustomer({\n        customer_type,\n        anrede: anrede || \"Keine Angabe\",\n        titel: titel || null,\n        vorname,\n        nachname,\n        firmenname: company_name || null,\n        email,\n        telefon: phone_mobile || phone_business || phone_private || null,\n        strasse: strasse || null,\n        plz: plz || null,\n        ort: stadt || null,\n        land: land || \"Deutschland\",\n        status: status || \"aktiv\",\n        support_level: support_level || \"Standard\",\n        notes: notes || null,\n      });\n\n      return NextResponse.json({\n        success: true,\n        message: \"Kunde erfolgreich erstellt\",\n        data: { \n          customer_id: newCustomer.id,\n          kundennummer: newCustomer.kundennummer,\n          customer: newCustomer,\n        },\n      });\n    } catch (createError: any) {\n      console.error(\"‚ùå Fehler beim Erstellen des Kunden (inner catch):\", createError);\n      console.error(\"‚ùå Error Stack:\", createError?.stack);\n      console.error(\"‚ùå Error Details:\", JSON.stringify(createError, null, 2));\n      \n      // Pr√ºfe ob es ein MySQL-Fehler ist\n      const mysqlError = createError?.code || createError?.sqlMessage || createError?.message;\n      \n      return NextResponse.json(\n        { \n          success: false, \n          message: mysqlError || \"Fehler beim Erstellen des Kunden in der Datenbank\",\n          error: process.env.NODE_ENV === \"development\" ? createError?.message : undefined,\n          code: createError?.code,\n        },\n        { status: 500 },\n      );\n    }\n  } catch (error: any) {\n    // √Ñu√üerer catch f√ºr unerwartete Fehler\n    console.error(\"‚ùå Fehler beim Erstellen des Kunden (outer catch):\", error);\n    console.error(\"‚ùå Error Stack:\", error?.stack);\n    \n    return NextResponse.json(\n      { \n        success: false, \n        message: error?.message || \"Unerwarteter Fehler beim Erstellen des Kunden\",\n        error: process.env.NODE_ENV === \"development\" ? error?.message : undefined,\n      },\n      { status: 500 },\n    );\n  }\n}\n\n// =====================================================\n// HILFSFUNKTIONEN\n// =====================================================\n\nasync function getCustomers(filters: any) {\n  // Demo-Daten (in Produktion: echte Datenbank-Abfrage)\n  const demoCustomers = [\n    {\n      id: \"customer_demo_1\",\n      customer_type: \"privat\",\n      anrede: \"Herr\",\n      titel: null,\n      vorname: \"Max\",\n      nachname: \"Mustermann\",\n      company_name: null,\n      ust_id: null,\n      contact_person_anrede: null,\n      contact_person_titel: null,\n      contact_person_vorname: null,\n      contact_person_nachname: null,\n      email: \"max.mustermann@email.de\",\n      email_secondary: null,\n      phone_mobile: \"+49 123 456789\",\n      phone_business: null,\n      phone_private: null,\n      strasse: \"Musterstra√üe 123\",\n      plz: \"30159\",\n      stadt: \"Hannover\",\n      land: \"Deutschland\",\n      land_iso: \"DE\",\n      support_level: \"Standard\",\n      account_manager: null,\n      account_manager_name: null,\n      account_manager_lastname: null,\n      status: \"aktiv\",\n      notes: null,\n      created_at: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),\n      updated_at: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),\n    },\n    {\n      id: \"customer_demo_2\",\n      customer_type: \"firma\",\n      anrede: \"Frau\",\n      titel: null,\n      vorname: \"Anna\",\n      nachname: \"Schmidt\",\n      company_name: \"Beispiel GmbH\",\n      ust_id: \"DE123456789\",\n      contact_person_anrede: \"Frau\",\n      contact_person_titel: null,\n      contact_person_vorname: \"Anna\",\n      contact_person_nachname: \"Schmidt\",\n      email: \"anna.schmidt@beispiel-gmbh.de\",\n      email_secondary: \"info@beispiel-gmbh.de\",\n      phone_mobile: \"+49 511 987654\",\n      phone_business: \"+49 511 987654\",\n      phone_private: null,\n      strasse: \"Firmenstra√üe 456\",\n      plz: \"30159\",\n      stadt: \"Hannover\",\n      land: \"Deutschland\",\n      land_iso: \"DE\",\n      support_level: \"Premium\",\n      account_manager: \"admin_user\",\n      account_manager_name: \"Lopez\",\n      account_manager_lastname: \"Admin\",\n      status: \"aktiv\",\n      notes: \"Wichtiger Kunde mit Premium-Support\",\n      created_at: new Date(Date.now() - 14 * 24 * 60 * 60 * 1000).toISOString(),\n      updated_at: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),\n    },\n    {\n      id: \"customer_demo_3\",\n      customer_type: \"beh√∂rde\",\n      anrede: \"Herr\",\n      titel: \"Dr.\",\n      vorname: \"M√ºller\",\n      nachname: \"Verwaltung\",\n      company_name: \"Stadt Hannover\",\n      ust_id: null,\n      contact_person_anrede: \"Herr\",\n      contact_person_titel: \"Dr.\",\n      contact_person_vorname: \"M√ºller\",\n      contact_person_nachname: \"Verwaltung\",\n      email: \"verwaltung@stadt-hannover.de\",\n      email_secondary: null,\n      phone_mobile: \"+49 511 555123\",\n      phone_business: \"+49 511 555123\",\n      phone_private: null,\n      strasse: \"Rathausplatz 1\",\n      plz: \"30159\",\n      stadt: \"Hannover\",\n      land: \"Deutschland\",\n      land_iso: \"DE\",\n      support_level: \"SLA 24h\",\n      account_manager: \"admin_user\",\n      account_manager_name: \"Lopez\",\n      account_manager_lastname: \"Admin\",\n      status: \"aktiv\",\n      notes: \"√ñffentliche Einrichtung - besondere Compliance-Anforderungen\",\n      created_at: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\n      updated_at: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),\n    },\n  ];\n\n  // Filter anwenden\n  let filteredCustomers = demoCustomers;\n\n  if (filters.customerType) {\n    filteredCustomers = filteredCustomers.filter((c) => c.customer_type === filters.customerType);\n  }\n  if (filters.status) {\n    filteredCustomers = filteredCustomers.filter((c) => c.status === filters.status);\n  }\n  if (filters.supportLevel) {\n    filteredCustomers = filteredCustomers.filter((c) => c.support_level === filters.supportLevel);\n  }\n  if (filters.land) {\n    filteredCustomers = filteredCustomers.filter((c) => c.land === filters.land);\n  }\n  if (filters.search) {\n    const searchLower = filters.search.toLowerCase();\n    filteredCustomers = filteredCustomers.filter(\n      (c) =>\n        c.vorname.toLowerCase().includes(searchLower) ||\n        c.nachname.toLowerCase().includes(searchLower) ||\n        c.email.toLowerCase().includes(searchLower) ||\n        (c.company_name && c.company_name.toLowerCase().includes(searchLower)) ||\n        c.stadt.toLowerCase().includes(searchLower),\n    );\n  }\n\n  // Sortierung\n  filteredCustomers.sort((a, b) => {\n    const aVal = a[filters.sortBy as keyof typeof a];\n    const bVal = b[filters.sortBy as keyof typeof b];\n\n    if (filters.sortOrder === \"ASC\") {\n      return aVal > bVal ? 1 : -1;\n    } else {\n      return aVal < bVal ? 1 : -1;\n    }\n  });\n\n  // Pagination\n  return filteredCustomers.slice(filters.offset, filters.offset + filters.limit);\n}\n\nasync function getCustomersCount(filters: any) {\n  // Demo: Einfache Z√§hlung (in Produktion: COUNT-Query)\n  return 3;\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}