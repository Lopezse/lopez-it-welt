{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 115, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/lib/db.ts"],"sourcesContent":["import mysql from \"mysql2/promise\";\n\n/**\n * Zentrale MySQL-Datenbankverbindung mit UTF-8 Konfiguration\n * Enterprise++ Standard für alle API-Routen\n *\n * @author Ramiro Lopez Rodriguez\n * @version 1.0.0\n * @date 2025-09-28\n */\n\n// MySQL-Verbindungskonfiguration - MySQL2-kompatibel\nconst dbConfig = {\n  host: \"localhost\",\n  user: \"root\",\n  password: \"\",\n  database: \"lopez_it_welt\",\n  port: 3306,\n  charset: \"utf8mb4\",\n  supportBigNumbers: true,\n  bigNumberStrings: true,\n  // MySQL2-spezifische Pool-Optionen\n  waitForConnections: true,\n  connectionLimit: 10,\n  queueLimit: 0,\n  acquireTimeout: 60000,\n  timeout: 60000,\n};\n\n// Verbindungspool für bessere Performance\nlet pool: mysql.Pool | null = null;\n\n/**\n * Erstellt oder gibt bestehenden Verbindungspool zurück\n */\nexport function getConnectionPool(): mysql.Pool {\n  if (!pool) {\n    pool = mysql.createPool({\n      host: \"localhost\",\n      user: \"root\",\n      password: \"\",\n      database: \"lopez_it_welt\",\n      port: 3306,\n      charset: \"utf8mb4\",\n      supportBigNumbers: true,\n      bigNumberStrings: true,\n      // Pool-spezifische Konfiguration (nur gültige Optionen)\n      waitForConnections: true,\n      connectionLimit: 10,\n      queueLimit: 0,\n    });\n  }\n  return pool;\n}\n\n/**\n * Erstellt eine neue Datenbankverbindung mit UTF-8 Konfiguration\n */\nexport async function createConnection(): Promise<mysql.Connection> {\n  try {\n    const connection = await mysql.createConnection(dbConfig);\n\n    // UTF-8 explizit setzen für maximale Kompatibilität\n    await connection.execute(\"SET NAMES utf8mb4\");\n    await connection.execute(\"SET CHARACTER SET utf8mb4\");\n    await connection.execute(\"SET character_set_connection=utf8mb4\");\n    await connection.execute(\"SET character_set_results=utf8mb4\");\n    await connection.execute(\"SET character_set_client=utf8mb4\");\n\n    return connection;\n  } catch (error) {\n    console.error(\"❌ MySQL-Verbindung fehlgeschlagen:\", error);\n    throw new Error(\n      `Datenbankverbindung fehlgeschlagen: ${error instanceof Error ? error.message : \"Unbekannter Fehler\"}`,\n    );\n  }\n}\n\n/**\n * Führt eine Query mit UTF-8 Konfiguration aus\n */\nexport async function executeQuery<T = any>(sql: string, params: any[] = []): Promise<T> {\n  const connection = await createConnection();\n  try {\n    const [rows] = await connection.execute(sql, params);\n    return rows as T;\n  } finally {\n    await connection.end();\n  }\n}\n\n/**\n * Führt eine Query mit Verbindungspool aus (für häufige Abfragen)\n */\nexport async function executeQueryPool<T = any>(sql: string, params: any[] = []): Promise<T> {\n  const pool = getConnectionPool();\n  const [rows] = await pool.execute(sql, params);\n  return rows as T;\n}\n\n/**\n * Schließt den Verbindungspool (beim Herunterfahren)\n */\nexport async function closePool(): Promise<void> {\n  if (pool) {\n    await pool.end();\n    pool = null;\n  }\n}\n\n/**\n * Testet die Datenbankverbindung\n */\nexport async function testConnection(): Promise<boolean> {\n  try {\n    const connection = await createConnection();\n    await connection.execute(\"SELECT 1\");\n    await connection.end();\n    return true;\n  } catch (error) {\n    console.error(\"❌ Datenbankverbindung fehlgeschlagen:\", error);\n    return false;\n  }\n}\n\n/**\n * Prüft UTF-8 Konfiguration der Datenbank\n */\nexport async function checkUTF8Config(): Promise<{\n  database: string;\n  server: string;\n  connection: string;\n  results: string;\n}> {\n  const connection = await createConnection();\n  try {\n    const [rows] = await connection.execute(`\n      SELECT \n        @@character_set_database as database,\n        @@character_set_server as server,\n        @@character_set_connection as connection,\n        @@character_set_results as results\n    `);\n\n    const result = (rows as any[])[0];\n    await connection.end();\n\n    return {\n      database: result.database,\n      server: result.server,\n      connection: result.connection,\n      results: result.results,\n    };\n  } catch (error) {\n    await connection.end();\n    throw error;\n  }\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;AAAA;;AAEA;;;;;;;CAOC,GAED,qDAAqD;AACrD,MAAM,WAAW;IACf,MAAM;IACN,MAAM;IACN,UAAU;IACV,UAAU;IACV,MAAM;IACN,SAAS;IACT,mBAAmB;IACnB,kBAAkB;IAClB,mCAAmC;IACnC,oBAAoB;IACpB,iBAAiB;IACjB,YAAY;IACZ,gBAAgB;IAChB,SAAS;AACX;AAEA,0CAA0C;AAC1C,IAAI,OAA0B;AAKvB,SAAS;IACd,IAAI,CAAC,MAAM;QACT,OAAO,8IAAK,CAAC,UAAU,CAAC;YACtB,MAAM;YACN,MAAM;YACN,UAAU;YACV,UAAU;YACV,MAAM;YACN,SAAS;YACT,mBAAmB;YACnB,kBAAkB;YAClB,wDAAwD;YACxD,oBAAoB;YACpB,iBAAiB;YACjB,YAAY;QACd;IACF;IACA,OAAO;AACT;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,aAAa,MAAM,8IAAK,CAAC,gBAAgB,CAAC;QAEhD,oDAAoD;QACpD,MAAM,WAAW,OAAO,CAAC;QACzB,MAAM,WAAW,OAAO,CAAC;QACzB,MAAM,WAAW,OAAO,CAAC;QACzB,MAAM,WAAW,OAAO,CAAC;QACzB,MAAM,WAAW,OAAO,CAAC;QAEzB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,sCAAsC;QACpD,MAAM,IAAI,MACR,CAAC,oCAAoC,EAAE,iBAAiB,QAAQ,MAAM,OAAO,GAAG,sBAAsB;IAE1G;AACF;AAKO,eAAe,aAAsB,GAAW,EAAE,SAAgB,EAAE;IACzE,MAAM,aAAa,MAAM;IACzB,IAAI;QACF,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CAAC,KAAK;QAC7C,OAAO;IACT,SAAU;QACR,MAAM,WAAW,GAAG;IACtB;AACF;AAKO,eAAe,iBAA0B,GAAW,EAAE,SAAgB,EAAE;IAC7E,MAAM,OAAO;IACb,MAAM,CAAC,KAAK,GAAG,MAAM,KAAK,OAAO,CAAC,KAAK;IACvC,OAAO;AACT;AAKO,eAAe;IACpB,IAAI,MAAM;QACR,MAAM,KAAK,GAAG;QACd,OAAO;IACT;AACF;AAKO,eAAe;IACpB,IAAI;QACF,MAAM,aAAa,MAAM;QACzB,MAAM,WAAW,OAAO,CAAC;QACzB,MAAM,WAAW,GAAG;QACpB,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yCAAyC;QACvD,OAAO;IACT;AACF;AAKO,eAAe;IAMpB,MAAM,aAAa,MAAM;IACzB,IAAI;QACF,MAAM,CAAC,KAAK,GAAG,MAAM,WAAW,OAAO,CAAC,CAAC;;;;;;IAMzC,CAAC;QAED,MAAM,SAAS,AAAC,IAAc,CAAC,EAAE;QACjC,MAAM,WAAW,GAAG;QAEpB,OAAO;YACL,UAAU,OAAO,QAAQ;YACzB,QAAQ,OAAO,MAAM;YACrB,YAAY,OAAO,UAAU;YAC7B,SAAS,OAAO,OAAO;QACzB;IACF,EAAE,OAAO,OAAO;QACd,MAAM,WAAW,GAAG;QACpB,MAAM;IACR;AACF","debugId":null}},
    {"offset": {"line": 263, "column": 0}, "map": {"version":3,"sources":["file:///D:/Projekte/lopez-it-welt/src/app/api/projects/route.ts"],"sourcesContent":["/**\n * GET /api/projects\n * POST /api/projects\n * Projekte verwalten\n */\n\nimport { createConnection } from \"@/lib/db\";\nimport { NextRequest, NextResponse } from \"next/server\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const customerId = searchParams.get(\"customer_id\");\n    const status = searchParams.get(\"status\");\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\n    const limit = parseInt(searchParams.get(\"limit\") || \"50\");\n\n    const connection = await createConnection();\n\n    let query = `\n      SELECT p.*, c.company_name, c.vorname, c.nachname, c.email\n      FROM lopez_projects p\n      LEFT JOIN lopez_customers c ON p.customer_id = c.id\n      WHERE 1=1\n    `;\n    const params: any[] = [];\n\n    if (customerId) {\n      query += \" AND p.customer_id = ?\";\n      params.push(customerId);\n    }\n\n    if (status) {\n      query += \" AND p.status = ?\";\n      params.push(status);\n    }\n\n    query += \" ORDER BY p.created_at DESC LIMIT ? OFFSET ?\";\n    params.push(limit, (page - 1) * limit);\n\n    const [rows] = await connection.execute(query, params);\n\n    // Gesamtanzahl\n    let countQuery = \"SELECT COUNT(*) as total FROM lopez_projects WHERE 1=1\";\n    const countParams: any[] = [];\n\n    if (customerId) {\n      countQuery += \" AND customer_id = ?\";\n      countParams.push(customerId);\n    }\n\n    if (status) {\n      countQuery += \" AND status = ?\";\n      countParams.push(status);\n    }\n\n    const [countRows] = await connection.execute(countQuery, countParams);\n    const total =\n      Array.isArray(countRows) && countRows.length > 0 ? (countRows[0] as any).total : 0;\n\n    await connection.end();\n\n    return NextResponse.json(\n      {\n        success: true,\n        data: {\n          projects: Array.isArray(rows) ? rows : [],\n          pagination: {\n            page,\n            limit,\n            total,\n            pages: Math.ceil(total / limit),\n          },\n        },\n      },\n      {\n        headers: { \"Content-Type\": \"application/json; charset=utf-8\" },\n      },\n    );\n  } catch (error) {\n    console.error(\"❌ Projects API Fehler:\", error);\n    return NextResponse.json(\n      { success: false, error: \"Fehler beim Laden der Projekte\" },\n      { status: 500 },\n    );\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const body = await request.json();\n    const {\n      customer_id,\n      project_code,\n      project_name,\n      description,\n      start_date,\n      end_date,\n      status = \"open\",\n      created_by,\n    } = body;\n\n    if (!customer_id || !project_name || !created_by) {\n      return NextResponse.json(\n        { success: false, error: \"customer_id, project_name und created_by sind erforderlich\" },\n        { status: 400 },\n      );\n    }\n\n    const connection = await createConnection();\n\n    const [result] = await connection.execute(\n      `INSERT INTO lopez_projects \n       (customer_id, project_code, project_name, description, start_date, end_date, status, created_by)\n       VALUES (?, ?, ?, ?, ?, ?, ?, ?)`,\n      [\n        customer_id,\n        project_code || null,\n        project_name,\n        description || null,\n        start_date || null,\n        end_date || null,\n        status,\n        created_by,\n      ],\n    );\n\n    const insertId = (result as any).insertId;\n\n    // Audit-Log\n    await connection.execute(\n      `INSERT INTO lopez_audit_logs (user_id, action, ref_table, ref_id, notes)\n       VALUES (?, 'PROJECT_CREATE', 'lopez_projects', ?, ?)`,\n      [created_by, insertId, `Projekt erstellt: ${project_name}`],\n    );\n\n    await connection.end();\n\n    return NextResponse.json(\n      {\n        success: true,\n        data: { id: insertId, message: \"Projekt erfolgreich erstellt\" },\n      },\n      {\n        headers: { \"Content-Type\": \"application/json; charset=utf-8\" },\n      },\n    );\n  } catch (error) {\n    console.error(\"❌ Projects API Fehler:\", error);\n    return NextResponse.json(\n      { success: false, error: \"Fehler beim Erstellen des Projekts\" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}